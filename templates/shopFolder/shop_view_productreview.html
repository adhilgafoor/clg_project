{% extends 'shopFolder/base_shop.html' %}

{% block content %}
<div class="container-fluid">
    <div class="card-glass">
        <h3 class="mb-4"><i class="fas fa-star me-2"></i>User Reviews</h3>

        <!-- Date Filters -->
        <div class="row mb-4 align-items-end">
            <div class="col-md-3">
                <label class="text-muted mb-1 small">From Date</label>
                <input type="date" id="fromDate" class="glass-input form-control text-white">
            </div>
            <div class="col-md-3">
                <label class="text-muted mb-1 small">To Date</label>
                <input type="date" id="toDate" class="glass-input form-control text-white">
            </div>
            <div class="col-md-2">
                <button onclick="filterTable()" class="glass-btn w-100 bg-primary border-0">
                    <i class="fas fa-filter me-2"></i> Filter
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table text-white">
                <thead>
                    <tr style="border-bottom: 1px solid var(--glass-border);">
                        <th>SL</th>
                        <th>Date</th>
                        <th>User Info</th>
                        <th>Rating</th>
                        <th>Review Details</th>
                    </tr>
                </thead>
                <tbody id="reviewsTable">
                    {% for i in data %}
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);" data-date="{{ i.Date|date:'Y-m-d' }}">
                        <td class="align-middle">{{ forloop.counter }}</td>
                        <td class="align-middle text-muted">{{ i.Date }}</td>
                        <td class="align-middle">
                            <div class="fw-bold">{{ i.USER.Name }}</div>
                            <small class="text-muted">{{ i.USER.Email }}</small>
                        </td>
                        <td class="align-middle">
                            <div class="text-warning">
                                {% for _ in "x"|ljust:i.Ratings %}
                                <i class="fas fa-star"></i>
                                {% endfor %}
                                <span class="text-muted ms-2 small">({{ i.Ratings }}/5)</span>
                            </div>
                        </td>
                        <td class="align-middle text-light fst-italic">"{{ i.Review }}"</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">No reviews found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function filterTable() {
        const fromDateVal = document.getElementById('fromDate').value;
        const toDateVal = document.getElementById('toDate').value;
        const fromDate = fromDateVal ? new Date(fromDateVal) : null;
        const toDate = toDateVal ? new Date(toDateVal) : null;

        const rows = document.querySelectorAll('#reviewsTable tr');

        rows.forEach(row => {
            const dateStr = row.getAttribute('data-date');
            if (!dateStr) return;
            const rowDate = new Date(dateStr);

            let show = true;
            if (fromDate && rowDate < fromDate) show = false;
            // Set toDate time to end of day to include the day itself
            if (toDate) {
                const toDateEndOfDay = new Date(toDate);
                toDateEndOfDay.setHours(23, 59, 59);
                if (rowDate > toDateEndOfDay) show = false;
            }

            row.style.display = show ? '' : 'none';
        });
    }
</script>
{% endblock %}