{% extends 'adminFolder/adminindex.html' %}
{% block body %}

<body style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); min-height: 100vh;">
    <div class="container-fluid py-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h1 class="h3 mb-1 text-primary"><i class="fas fa-building me-2"></i>Business Accounts
                                </h1>
                                <p class="text-muted mb-0">View all registered business accounts</p>
                            </div>
                            <div class="badge bg-primary p-2">
                                <i class="fas fa-users me-1"></i>
                                <span id="accountCount">{{ data|length }}</span> Accounts
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-4">
                                <label class="form-label fw-semibold">Search Business</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchInput"
                                        placeholder="Search by name, email, or business type...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Business Type</label>
                                <select class="form-select" id="typeFilter">
                                    <option value="all">All Types</option>
                                    <option value="retail">Retail</option>
                                    <option value="service">Service</option>
                                    <option value="manufacturing">Manufacturing</option>
                                    <option value="restaurant">Restaurant</option>
                                    <option value="technology">Technology</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-semibold">District</label>
                                <select class="form-select" id="districtFilter">
                                    <option value="all">All Districts</option>
                                    <!-- Districts will be populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                                    <i class="fas fa-refresh me-1"></i>Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Accounts Grid -->
        <div class="row" id="businessGrid">
            {% for account in data %}
            <div class="col-xl-4 col-lg-6 col-md-6 mb-4 business-card" data-name="{{ account.Name|lower }}"
                data-email="{{ account.Email|lower }}" data-type="{{ account.Type|lower }}"
                data-district="{{ account.District|lower }}">
                <div class="card h-100 shadow-sm border-0 business-account-card">
                    <div class="card-header bg-white border-0 pb-0">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h5 class="card-title mb-1 text-primary">{{ account.Name }}</h5>
                                <p class="text-muted small mb-2">
                                    <i class="fas fa-envelope me-1"></i>{{ account.Email }}
                                </p>
                            </div>
                            <span class="badge {% if account.Type == 'Retail' %}bg-purple
                                              {% elif account.Type == 'Service' %}bg-teal
                                              {% elif account.Type == 'Manufacturing' %}bg-orange
                                              {% elif account.Type == 'Restaurant' %}bg-red
                                              {% elif account.Type == 'Technology' %}bg-blue
                                              {% else %}bg-secondary{% endif %} text-white">
                                {{ account.Type }}
                            </span>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Contact Information -->
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="fas fa-phone me-1"></i>Contact</h6>
                            <p class="mb-1">{{ account.Phone }}</p>
                        </div>

                        <!-- Address Information -->
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="fas fa-map-marker-alt me-1"></i>Address</h6>
                            <p class="mb-1 small">
                                {{ account.Place }}<br>
                                {{ account.District }}<br>
                                PIN: {{ account.Pin }}
                            </p>
                        </div>

                        <!-- Documents Section -->
                        <div class="mb-3">
                            <h6 class="text-muted mb-2"><i class="fas fa-file-alt me-1"></i>Documents</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="document-thumbnail position-relative">
                                        <img src="{{ account.Photo.url }}" class="img-fluid rounded border"
                                            alt="Business Photo" style="height: 80px; width: 100%; object-fit: cover;">
                                        <a href="{{ account.Photo.url }}" target="_blank"
                                            class="btn btn-sm btn-light position-absolute top-0 end-0 m-1">
                                            <i class="fas fa-expand"></i>
                                        </a>
                                    </div>
                                    <small class="text-center d-block mt-1">Business Photo</small>
                                </div>
                                <div class="col-6">
                                    {% if account.Proof %}
                                    <div class="document-thumbnail position-relative">
                                        <div class="bg-light rounded border d-flex align-items-center justify-content-center"
                                            style="height: 80px;">
                                            <i class="fas fa-file-pdf text-danger fa-2x"></i>
                                        </div>
                                        <a href="{{ account.Proof.url }}" target="_blank"
                                            class="btn btn-sm btn-light position-absolute top-0 end-0 m-1">
                                            <i class="fas fa-expand"></i>
                                        </a>
                                    </div>
                                    <small class="text-center d-block mt-1">Business Proof</small>
                                    {% else %}
                                    <div class="bg-light rounded border d-flex align-items-center justify-content-center"
                                        style="height: 80px;">
                                        <span class="text-muted small">No Proof</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Location Map -->
                        <div class="mt-3">
                            <a href="https://www.google.com/maps?q={{ account.latitude }},{{ account.longitude }}"
                                target="_blank" class="btn btn-outline-primary w-100">
                                <i class="fas fa-map-marked-alt me-1"></i>View on Google Maps
                            </a>
                        </div>
                        <!-- Delete Button -->
                        <div class="mt-2">
                            <a href="/admin_delete_buissness/{{ account.id }}" class="btn btn-outline-danger w-100"
                                onclick="return confirm('Are you sure you want to delete this business account? This action cannot be undone.');">
                                <i class="fas fa-trash-alt me-1"></i>Delete Account
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body text-center py-5">
                        <div class="text-muted">
                            <i class="fas fa-building fa-3x mb-3"></i>
                            <h4>No Business Accounts Found</h4>
                            <p class="mb-0">There are no registered business accounts at the moment.</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Statistics Section -->
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        /* Custom badge colors */
        .bg-purple {
            background-color: #6f42c1 !important;
        }

        .bg-teal {
            background-color: #20c997 !important;
        }

        .bg-orange {
            background-color: #fd7e14 !important;
        }

        .bg-red {
            background-color: #dc3545 !important;
        }

        .bg-blue {
            background-color: #0d6efd !important;
        }

        /* Text colors for statistics */
        .text-purple {
            color: #6f42c1 !important;
        }

        .text-teal {
            color: #20c997 !important;
        }

        .text-orange {
            color: #fd7e14 !important;
        }

        /* Card hover effects */
        .business-account-card {
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .business-account-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
            border-color: #0d6efd;
        }

        /* Document thumbnail hover effects */
        .document-thumbnail:hover img,
        .document-thumbnail:hover div {
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        /* Smooth animations */
        .business-card {
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <script>
        // Initialize counts and filters
        document.addEventListener('DOMContentLoaded', function () {
            updateStatistics();
            populateDistrictFilter();
            populateTypeFilter();
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function () {
            filterBusinesses();
        });

        // Filter functionality
        document.getElementById('typeFilter').addEventListener('change', filterBusinesses);
        document.getElementById('districtFilter').addEventListener('change', filterBusinesses);

        function filterBusinesses() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const districtFilter = document.getElementById('districtFilter').value;

            const cards = document.querySelectorAll('.business-card');
            let visibleCount = 0;

            cards.forEach(card => {
                const name = card.getAttribute('data-name');
                const email = card.getAttribute('data-email');
                const type = card.getAttribute('data-type');
                const district = card.getAttribute('data-district');

                const matchesSearch = name.includes(searchTerm) || email.includes(searchTerm) || type.includes(searchTerm);
                const matchesType = typeFilter === 'all' || type === typeFilter;
                const matchesDistrict = districtFilter === 'all' || district === districtFilter;

                if (matchesSearch && matchesType && matchesDistrict) {
                    card.style.display = '';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            document.getElementById('accountCount').textContent = visibleCount;
            updateStatistics();
        }

        function updateStatistics() {
            const cards = document.querySelectorAll('.business-card:not([style*="display: none"])');
            let retail = 0, service = 0, manufacturing = 0;

            cards.forEach(card => {
                const type = card.getAttribute('data-type');
                if (type === 'retail') retail++;
                else if (type === 'service') service++;
                else if (type === 'manufacturing') manufacturing++;
            });

            document.getElementById('totalCount').textContent = cards.length;
            document.getElementById('retailCount').textContent = retail;
            document.getElementById('serviceCount').textContent = service;
            document.getElementById('manufacturingCount').textContent = manufacturing;
        }

        function populateDistrictFilter() {
            const districts = new Set();
            document.querySelectorAll('.business-card').forEach(card => {
                const district = card.getAttribute('data-district');
                if (district && district !== 'null') {
                    districts.add(district);
                }
            });

            const districtFilter = document.getElementById('districtFilter');
            while (districtFilter.children.length > 1) {
                districtFilter.removeChild(districtFilter.lastChild);
            }

            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district.charAt(0).toUpperCase() + district.slice(1);
                districtFilter.appendChild(option);
            });
        }

        function populateTypeFilter() {
            const types = new Set();
            document.querySelectorAll('.business-card').forEach(card => {
                const type = card.getAttribute('data-type');
                if (type && type !== 'null') {
                    types.add(type);
                }
            });

            const typeFilter = document.getElementById('typeFilter');
            types.forEach(type => {
                const existingOptions = Array.from(typeFilter.options).map(opt => opt.value);
                if (!existingOptions.includes(type)) {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    typeFilter.appendChild(option);
                }
            });
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('typeFilter').value = 'all';
            document.getElementById('districtFilter').value = 'all';
            filterBusinesses();
        }
    </script>
</body>
{% endblock %}


{#{% extends 'adminFolder/adminindex.html' %}#}
{#{% block body %}#}
{#

<body>#}
    {# <h1>Business Account Requests</h1>#}
    {#<form method="post">#}
        {# <table border="1">#}
            {# <thead>#}
                {# <tr>#}
                    {# <th>Name</th>#}
                    {# <th>Email</th>#}
                    {# <th>Phone</th>#}
                    {# <th>Address</th>#}
                    {# <th>Business Type</th>#}
                    {# <th>Location</th>#}
                    {# <th>Photo</th>#}
                    {# <th>Proof</th>#}
                    {# </tr>#}
                {# </thead>#}
            {# <tbody>#}
                {# {% for account in data %}#}
                {# <tr>#}
                    {# <td>{{ account.Name }}</td>#}
                    {# <td>{{ account.Email }}</td>#}
                    {# <td>{{ account.Phone }}</td>#}
                    {# <td>#}
                        {# {{ account.Place }}<br>#}
                        {# {{ account.District }}<br>#}
                        {# {{ account.Pin }}<br>#}
                        {##}
                        {# </td>#}
                    {# <td>{{ account.Type }}</td>#}
                    {# <td>#}
                        {# <a href="https://www.google.com/maps?q={{ account.latitude }}, {{ account.longitude }}"
                            target="_blank"
                            style="display: inline-block; margin-top: 8px; padding: 5px 10px; background-color: #465fff; color: white; text-decoration: none; border-radius: 3px; font-size: 12px;">#}
                            {# View on Map#}
                            {# </a>#}
                        {# </td>#}
                    {##}
                    {# <td>#}
                        {# <img src="{{ account.Photo.url }}" height="100" width="100">#}
                        {# <a href="{{ account.Photo.url }}" target="_blank">View Photo</a>#}
                        {# #}
                        {# </td>#}
                    {# <td>#}
                        {# {% if account.Proof %}#}
                        {# <a href="{{ account.Proof.url }}" target="_blank">View Proof</a>#}
                        {# {% else %}#}
                        {# No Proof#}
                        {# {% endif %}#}
                        {# </td>#}
                    {##}
                    {# </tr>#}
                {# <tr>#}
                    {# <td colspan="11">No business account requests found.</td>#}
                    {# </tr>#}
                {# {% endfor %}#}
                {# </tbody>#}
            {# </table>#}
        {#</form>#}
    {#</body>#}
{#{% endblock %}#}