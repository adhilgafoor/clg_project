{% extends 'adminFolder/adminindex.html' %}
{% block body %}
<body style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); min-height: 100vh;">
    <div class="container-fluid py-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h1 class="h3 mb-1 text-primary"><i class="fas fa-exclamation-circle me-2"></i>Complaints Management</h1>
                                <p class="text-muted mb-0">Manage and respond to user complaints</p>
                            </div>
                            <div class="badge bg-primary p-2">
                                <i class="fas fa-inbox me-1"></i>
                                <span id="complaintCount">{{ data|length }}</span> Complaints
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <form method="post" action="/admin_view_complaints_search">
                            {% csrf_token %}
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">From Date</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-calendar-alt"></i></span>
                                        <input class="form-control" type="date" name="fdate" aria-label="From date">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">To Date</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-calendar-alt"></i></span>
                                        <input class="form-control" type="date" name="tdate" aria-label="To date">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" type="submit">
                                        <i class="fas fa-search me-2"></i>Search Complaints
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>



        <!-- Complaints Table -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-4">#</th>
                                        <th>
                                            <i class="fas fa-calendar me-2"></i>Date
                                        </th>
                                        <th>
                                            <i class="fas fa-comment-dots me-2"></i>Complaint
                                        </th>
                                        <th>
                                            <i class="fas fa-user me-2"></i>User Details
                                        </th>
                                        <th>
                                            <i class="fas fa-info-circle me-2"></i>Status
                                        </th>
                                        <th class="text-center pe-4">
                                            <i class="fas fa-reply me-2"></i>Action
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in data %}
                                    <tr class="complaint-row" data-status="{{ i.Status|lower }}">
                                        <td class="ps-4 fw-semibold text-muted">
                                            {{ forloop.counter }}
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark">
                                                <i class="fas fa-clock me-1"></i>
                                                {{ i.Date }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="complaint-text">
                                                <p class="mb-0 text-dark" style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                    {{ i.Complaints }}
                                                </p>
                                                <small class="text-muted">Click to view full complaint</small>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="user-info">
                                                <h6 class="mb-1 fw-semibold">{{ i.USER.Name }}</h6>
                                                <p class="mb-1 small text-muted">
                                                    <i class="fas fa-envelope me-1"></i>{{ i.USER.Email }}
                                                </p>
                                                <p class="mb-0 small text-muted">
                                                    <i class="fas fa-phone me-1"></i>{{ i.USER.Phone }}
                                                </p>
                                            </div>
                                        </td>
                                        <td>
                                            {% if i.Status == "pending" %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="fas fa-clock me-1"></i>Pending
                                                </span>
                                            {% else %}
                                                <span class="badge bg-success text-white">
                                                    <i class="fas fa-check me-1"></i>Replied
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center pe-4">
                                            {% if i.Status == "pending" %}
                                                <a href="/admin_reply_complaints/{{ i.id }}" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-reply me-1"></i>Reply
                                                </a>
                                            {% else %}
                                                <div class="reply-preview">
                                                    <button class="btn btn-outline-success btn-sm"
                                                            data-bs-toggle="popover"
                                                            data-bs-placement="left"
                                                            data-bs-content="{{ i.Reply }}"
                                                            data-bs-trigger="hover">
                                                        <i class="fas fa-eye me-1"></i>View Reply
                                                    </button>
                                                </div>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center py-5">
                                            <div class="text-muted">
                                                <i class="fas fa-inbox fa-3x mb-3"></i>
                                                <h4>No Complaints Found</h4>
                                                <p class="mb-0">There are no complaints matching your search criteria.</p>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        .complaint-row:hover {
            background-color: #f8f9fa;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        .complaint-text {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complaint-text:hover {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 0.5rem;
        }

        .user-info {
            min-width: 200px;
        }

        .table th {
            border-bottom: 2px solid #e9ecef;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
        }

        .badge {
            font-weight: 500;
            padding: 0.5em 0.75em;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        .card {
            border: none;
            border-radius: 0.75rem;
        }
    </style>

    <script>
        // Initialize statistics and popovers
        document.addEventListener('DOMContentLoaded', function() {
            updateStatistics();
            initializePopovers();

            // Add click to view full complaint
            document.querySelectorAll('.complaint-text').forEach(element => {
                element.addEventListener('click', function() {
                    const complaintText = this.querySelector('p').textContent;
                    alert('Full Complaint:\n\n' + complaintText);
                });
            });
        });

        function updateStatistics() {
            const pendingCount = document.querySelectorAll('.complaint-row[data-status="pending"]').length;
            const repliedCount = document.querySelectorAll('.complaint-row[data-status="replied"]').length;
            const totalCount = {{ data|length }};

            // Get today's date for counting today's complaints
            const today = new Date().toISOString().split('T')[0];
            const todayCount = document.querySelectorAll('.complaint-row').length; // This would need actual date comparison

            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('repliedCount').textContent = repliedCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('todayCount').textContent = todayCount;

            // Update main complaint count
            document.getElementById('complaintCount').textContent = totalCount;
        }

        function initializePopovers() {
            const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
            const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                return new bootstrap.Popover(popoverTriggerEl);
            });
        }

        // Add hover effects to buttons
        document.querySelectorAll('.btn').forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-1px)';
                this.style.transition = 'all 0.2s ease';
            });

            button.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Auto-set date inputs to reasonable defaults
        window.addEventListener('load', function() {
            const today = new Date();
            const oneWeekAgo = new Date(today);
            oneWeekAgo.setDate(today.getDate() - 7);

            const dateInputs = document.querySelectorAll('input[type="date"]');
            if (dateInputs[0] && !dateInputs[0].value) {
                dateInputs[0].value = oneWeekAgo.toISOString().split('T')[0];
            }
            if (dateInputs[1] && !dateInputs[1].value) {
                dateInputs[1].value = today.toISOString().split('T')[0];
            }
        });
    </script>
</body>
{% endblock %}


{#{% extends 'adminFolder/adminindex.html' %}#}
{#{% block body %}#}
{#<body>#}
{#    <h1>Complaints</h1>#}
{#<form method="post" action="/admin_view_complaints_search">#}
{#{% csrf_token %}#}
{#<table>#}
{#    <thead>#}
{#    <tr>#}
{#         <input class="form-control me-2" type="date" placeholder="Search by date" name="fdate" aria-label="Search" style="max-width: 300px;">#}
{#         <input class="form-control me-2" type="date" placeholder="Search by date" name="tdate" aria-label="Search" style="max-width: 300px;">#}
{#        <button class="btn btn-outline-success" type="submit">Search</button>#}
{#    </tr>#}
{#    </thead>#}
{#</table>#}
{#    <table border="1">#}
{#        <thead><tr>#}
{#            <a href="/admin_add_category">Add Category</a>#}
{#        </tr>#}
{#            <tr>#}
{#                <th>Slno</th>#}
{#                <th>Date</th>#}
{#                <th>Complaints</th>#}
{#                <th>UserDetails</th>#}
{#                <th>Status</th>#}
{#                <th>Reply</th>#}
{#            </tr>#}
{#        </thead>#}
{#        <tbody>#}
{#            {% for i in data %}#}
{#            <tr>#}
{#                <td>{{ forloop.counter }}</td>#}
{#                <td>{{ i.Date }}</td>#}
{#                <td>{{ i.Complaints }}</td>#}
{#                <td>#}
{#                    {{ i.USER.Name }}<br>#}
{#                    {{ i.USER.Email }}<br>#}
{#                    {{ i.USER.Phone }}<br>#}
{##}
{#                </td>#}
{#                 <td>{{ i.Status }}</td>#}
{#                <td>#}
{#                    {% if i.Status == "pending" %}#}
{#                <a href="/admin_reply_complaints/{{ i.id }}">Reply</a>#}
{#                        {% else %}#}
{#                        {{ i.Reply }}#}
{#                    {% endif %}#}
{#                </td>#}
{#            </tr>#}
{#            {% endfor %}#}
{#        </tbody>#}
{#    </table>#}
{##}
{#</form>#}
{#</body>#}
{#{% endblock %}#}